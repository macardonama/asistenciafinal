<div id="dashboard">
<h1>Dashboard de Asistencia</h1>

<!-- FILTROS -->
<div class="filtros">
  <label>Fecha inicio:</label>
  <input type="date" [(ngModel)]="fechaInicio" (change)="filtrarDatos()">

  <label>Fecha fin:</label>
  <input type="date" [(ngModel)]="fechaFin" (change)="filtrarDatos()">

  <label>Grupo:</label>
  <select [(ngModel)]="grupoSeleccionado" (change)="filtrarDatos()">
    <option value="Todos">Todos</option>
    <option *ngFor="let grupo of gruposDisponibles" [value]="grupo">{{ grupo }}</option>
  </select>

  <label>Estado:</label>
  <select [(ngModel)]="estadoSeleccionado" (change)="filtrarDatos()">
    <option value="Todos">Todos</option>
    <option value="Presente">Presente</option>
    <option value="Ausente">Ausente</option>
  </select>

  <label>Día semana:</label>
  <select [(ngModel)]="diaSeleccionado" (change)="filtrarDatos()">
    <option *ngFor="let dia of diasDisponibles" [value]="dia">{{ dia }}</option>
  </select>
</div>
<div class="exportaciones">
  <button (click)="exportarExcel()">Exportar Excel (Filtrado)</button>
  <button (click)="exportarPDFVista()">Exportar PDF Completo</button>
</div>

<div class="exportaciones">
  <label>Exportar PDF individual:</label>
  <select #estudianteSeleccionado>
    <option *ngFor="let estudiante of asistenciasFiltradas" [value]="estudiante.name">{{ estudiante.name }}</option>
  </select>
  <button (click)="exportarPDFPorEstudiante(estudianteSeleccionado.value)">Exportar PDF</button>
</div>


<!-- KPI -->
<div class="resumen-cards">
  <div class="card">Total registros: {{ totalRegistros }}</div>
  <div class="card">Presentes: {{ totalPresentes }}</div>
  <div class="card">Ausentes: {{ totalAusentes }}</div>
  <div class="card">Asistencia: {{ porcentajeAsistencia | number:'1.0-2' }}%</div>
  <div class="card">Emoción dominante: {{ emocionDominante }}</div>
</div>

<!-- GRÁFICOS -->
<div class="graficos">
  <apx-chart *ngIf="lineChartOptions"
    [series]="lineChartOptions.series"
    [chart]="lineChartOptions.chart"
    [xaxis]="lineChartOptions.xaxis"
    [title]="lineChartOptions.title">
  </apx-chart>

  <apx-chart *ngIf="barChartOptions"
    [series]="barChartOptions.series"
    [chart]="barChartOptions.chart"
    [xaxis]="barChartOptions.xaxis"
    [title]="barChartOptions.title">
  </apx-chart>

  <apx-chart *ngIf="pieChartOptions"
    [series]="pieChartOptions.series"
    [chart]="pieChartOptions.chart"
    [labels]="pieChartOptions.labels"
    [responsive]="pieChartOptions.responsive">
  </apx-chart>
</div>

<!-- TABLA -->
<h2>Tabla de registros</h2>
<div *ngIf="asistenciasFiltradas.length > 0; else noData">
  <table>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Nombre</th>
        <th>Emoji</th>
        <th>Estado</th>
        <th>Grupo</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let asistencia of asistenciasFiltradas">
        <td>{{ asistencia.createdAt | date:'yyyy-MM-dd HH:mm:ss' }}</td>
        <td>{{ asistencia.name }}</td>
        <td>{{ asistencia.emoji }}</td>
        <td>{{ asistencia.estado }}</td>
        <td>{{ asistencia.grupo }}</td>
      </tr>
    </tbody>
  </table>
</div>

<ng-template #noData>
  <p>No hay datos disponibles.</p>
</ng-template>
</div>